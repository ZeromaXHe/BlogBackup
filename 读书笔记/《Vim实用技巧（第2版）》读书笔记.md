# 写作体例说明

## 在书页中模拟 Vim 的标记

| 标记              | 含义                                           |
| ----------------- | ---------------------------------------------- |
| `x`               | 按一次 x                                       |
| `dw`              | 依次按 d、w                                    |
| `dap`             | 依次按 d、a、p                                 |
| `<C-n>`           | 同时按 `<Ctrl>` 和 n                           |
| `g<C-]>`          | 按 g，然后同时按 `<Ctrl>` 和 ]                 |
| `<C-w>><C-=>`     | 同时按 `<Ctrl>` 和 w，然后同时按 `<Ctrl>` 和 = |
| `f{char}`         | 按 f，后面跟任意字符                           |
| ``{a-z}`          | 按 `，后面跟任意小写字母                       |
| `m{a-zA-Z}`       | 按 m，后面跟任意小写或大写字母                 |
| `d{motion}`       | 按 d，后面跟任意动作命令                       |
| `<C-r>{register}` | 同时按 `<Ctrl>` 和 r，后面跟一个寄存器地址     |
| `<Esc>`           | 按退出键                                       |
| `<CR>`            | 按回车键，也写作 `<Enter>`                     |
| `<Ctrl>`          | 按控制键                                       |
| `<Tab>`           | 按制表键                                       |
| `<Shift>`         | 按切换键                                       |
| `<S-Tab>`         | 同时按 `<Shift>` 和 `<Tab>`                    |
| `<Up>`            | 按上光标键                                     |
| `<Down>`          | 按下光标键                                     |
| `␣`               | 按空格键                                       |
| $                 | 在外部 Shell 中执行命令行命令                  |
| :                 | 用命令行模式执行一条 Ex 命令                   |
| /                 | 用命令行模式执行正向查找                       |
| ?                 | 用命令行模式执行反向查找                       |
| =                 | 用命令行模式对一个 Vim 脚本表达式求值          |



`dw` 删除光标下的单词



# 第 1 章 Vim 解决问题的方式

## 技巧 1 认识 `.` 命令

`x` 删除光标下的字符

`.` 重复上次修改

`u` 撤销上次修改

`dd` 整行删除

`>G` 增加从当前行到文档末尾处的缩进层级

> 每次进入插入模式时，也会形成依次修改。从进入插入模式的那一刻起（例如输入 i），直到返回普通模式时为止（输入 `<Esc>`），Vim 会记录每一个按键操作。

## 技巧 2 不要自我重复

`$` 移到行尾

`a` 在当前光标后添加内容

`A` 在当前行的结尾添加内容

| 复合命令 | 等效的长命令 |
| -------- | ------------ |
| `C`      | `c$`         |
| `s`      | `cl`         |
| `S`      | `^C`         |
| `I`      | `^i`         |
| `A`      | `$a`         |
| `o`      | `A<CR>`      |
| `O`      | `ko`         |

## 技巧 3 以退为进

`s` 先删除光标下的字符，然后进入插入模式

`f{char}` 查找下一处指定字符出现的位置

`;` 重复上次 f 命令所查找的字符

## 技巧 4 执行、重复、回退

`,` 反方向查找上次 f{char} 所查找的字符

| 目的                     | 操作                  | 重复 | 回退 |
| ------------------------ | --------------------- | ---- | ---- |
| 做出一个修改             | {edit}                | `.`  | `u`  |
| 在行内查找下一指定字符   | `f{char}` / `t{char}` | `;`  | `,`  |
| 在行内查找上一指定字符   | `F{char}` / `T{char}` | `;`  | `,`  |
| 在文档中查找下一处匹配项 | /pattern`<CR>`        | `n`  | `N`  |
| 在文档中查找上一处匹配项 | ?pattern`<CR>`        | `n`  | `N`  |
| 执行替换                 | :s/target/replacement | `&`  | `u`  |
| 执行一系列修改           | `qx{change}q`         | `@x` | `u`  |

## 技巧 5 查找并手动替换

`*` 查找光标所处的单词（如果没有高亮单词出现的地方，试着运行 `:set hls`）

`cw` 删除从光标位置到单词结尾间的字符，并进入插入模式

## 技巧 6 认识 `.` 范式

用一键移动，另一键执行

# 第一部分 模式

# 第 2 章 普通模式

## 技巧 7 停顿时请移开画笔

## 技巧 8 把撤销单元切成块

## 技巧 9 构造可重复的修改

`db` 命令删除从光标起始位置到单词开头的内容

`b` 把光标移到单词的开头

`daw` 删除一个单词（aw 文本对象）

## 技巧 10 用次数做简单的算术运算

`<C-a>` 和 `<C-x>` 命令分别对数字执行加和减操作。在不带次数执行时，它们会逐个加减。光标移到字符 5 上执行 `10<C-a>` 就会把它变成 15。如果光标不在数字上，命令将在当前行正向查找一个数字。

> 007 会被识别为八进制，加一的下一个数字是 010。如需取消默认行为，把下面这行加入 vimrc 里：
>
> ```sh
> set nrformats=
> ```
>
> 这会让 Vim 把所有数字都当成十进制，不管它们是不是以 0 开头的

## 技巧 11 能够重复，就别用次数

## 技巧 12 双剑合璧，天下无敌

`d{motion}` 命令可以对一个字符（`dl`）、一个完整单词（`daw`）或一整个段落（`dap`）进行操作，它作用的范围由动作命令决定。`c{motion}`、`y{motion}` 以及其他一些命令也类似，它们被统称为操作符（operator）。

`g~`、`gu`、`gU` 命令要用两次按键来调用，我们可以把上述命令中的 g 当作一个前缀字符，用以改变其后面的按键行为。

| 命令 | 用途                                 |
| ---- | ------------------------------------ |
| c    | 修改                                 |
| d    | 删除                                 |
| y    | 复制到寄存器                         |
| g~   | 反转大小写                           |
| gu   | 转换为小写                           |
| gU   | 转换为大写                           |
| >    | 增加缩进                             |
| <    | 减小缩进                             |
| =    | 自动缩进                             |
| !    | 使用外部程序过滤 {motion} 所跨越的行 |

# 第 3 章 插入模式

## 技巧 13 在插入模式中可即时更正错误

| 按键操作 | 用途                       |
| -------- | -------------------------- |
| `<C-h>`  | 删除前一个字符（同退格键） |
| `<C-w>`  | 删除前一个单词             |
| `<C-u>`  | 删至行首                   |

这些命令不是插入模式独有的，甚至也不是 Vim 独有的，在 Vim 的命令行模式中，以及在 bash shell 中，也可以使用它们。

## 技巧 14 返回普通模式

| 按键操作 | 用途                |
| -------- | ------------------- |
| `<Esc>`  | 切换到普通模式      |
| `<C-[>`  | 切换到普通模式      |
| `<C-o>`  | 切换到插入-普通模式 |

插入-普通模式是普通模式的一个特例，它能让我们执行一次普通模式命令。在此模式中，可以执行一个普通模式命令，执行完后，马上又返回到插入模式。

`zz` 命令可以重绘屏幕，并把当前行显示在窗口正中，这样就能够阅读当前行之上即之下的半屏内容。

## 技巧 15 不离开插入模式，粘贴寄存器中的文本

`yt,` 命令把光标到下一个逗号前的字符串复制到专用寄存器中

在插入模式中，按 `<C-r>0` 把刚才复制的文本粘贴到光标所在位置。这个命令的一般格式是 `<C-r>{register}`，其中 `{register}` 是想要插入的寄存器的名字

`<C-r><C-p>{register}` 命令则会按原义插入寄存器内的文本，并修正任何不必要的缩进。

## 技巧 16 随时随地做运算

表达式寄存器可以用来执行一段 Vim 脚本，并返回其结果。

可以用 = 符号指明使用表达式寄存器。在插入模式中，输入 `<C-r>=` 就可以访问这一寄存器。这条命令会在屏幕的下方显示一个提示符，可以在其后输入要执行的表达式。输入表达式后敲一下 `<CR>`，Vim 就会把执行的结果插入文档的当前位置了。

## 技巧 17 用字符编码插入非常用字符

要根据字符编码插入字符，只需在插入模式中输入 `<C-v>{code}` 即可，其中 `{code}` 是要插入字符的编码。

如果想插入一个编码超过 3 位数的字符该怎么办？例如，Unicode 基本多文种平面（Unicode Basic Multilingual Plane）的地址空间最大会有 65535 个字符。解决方法是用 4 位十六进制编码来输入这些字符，即输入`<C-v>u{1234}`（注意数字前的 u）。加入想插入字符编码为 00bf 的反转问号（“¿”），只需在插入模式输入 `<C-v>u00bf` 即可。

如果你想知道文档中任意字符的编码，只需把光标移到它上面并按 `ga` 命令，然后屏幕下方会显示出一条消息，分别以十进制和十六进制的形式显示出其字符编码。

`<C-v>` 命令后面跟一个非数字键，它会插入这个按键本身代表的字符。

| 按键操作              | 用途                                   |
| --------------------- | -------------------------------------- |
| `<C-v>{123}`          | 以十进制字符编码插入字符               |
| `<C-v>u{1234}`        | 以十六进制字符编码插入字符             |
| `<C-v>{nondigit}`     | 按原义插入非数字字符                   |
| `<C-k>{char1}{char2}` | 插入以二合字母{char1}{char2}表示的字符 |

## 技巧 18 用二合字母插入非常用字符

因此，如果想输入以二合字母 ?I 表示的“¿”字符，可以简单地输入 `<C-k>?I` 。

例如，左右书名号《和》 分别以二合字母<<及>>表示，普通分数（或常用分数）½、¼和 ¾ 则分别以二合字母12、14 和 34 来表示。

用命令 `:digraphs` 可以查看可用的二合字母列表，不过该命令的输出不太好阅读。也可以用 `:h digraph-table` 查看另一个更为有用的列表。

## 技巧 19 用替换模式替换已有文本

`R` 命令可以由普通模式进入替换模式。

完成替换后，可以按 `<Esc>` 键返回普通模式。如果你的键盘上有 `<Insert>` 键，那么也可以用该键在插入模式和替换模式间切换。

不过 Vim 还有另外一种替换模式，称为虚拟替换模式（virtual replace mode）。该模式可由 `gR` 命令触发，它会把制表符当成一组空格进行处理。

Vim 也提供了单次版本的替换模式及虚拟替换模式。`r{char}` 和 `gr{char}` 命令允许覆盖一个字符，之后马上又回到普通模式。

# 第 4 章 可视模式

## 技巧 20 深入理解可视模式

某些可视模式命令执行的基本功能与普通模式相同，但操作上有些细微的变化。例如，在这两种模式中， c 命令的功能是一样的，都是删除指定的文本并切换到插入模式。不过，要指定其操作的范围，二者的方式却不甚相同。

在普通模式中，先触发修改命令，然后使用动作命令指定其作用范围，这个命令被称为操作符命令。然而，在可视模式中，要先选中选区，然后再触发修改命令。这种次序颠倒的方式对所有的操作符命令都适用。对大多数人来说，可视模式的做法感觉起来更自然。

## 技巧 21 选择高亮选区

在普通模式下，按 `v` 可激活面向字符的可视模式，按 `V`（v 和 Shift 键一起按）可激活面向行的可视模式，而按 `<C-v>`（v 和 Ctrl 键一起按）则可激活面向列块的可视模式

| 命令    | 用途                   |
| ------- | ---------------------- |
| `v`     | 激活面向字符的可视模式 |
| `V`     | 激活面向行的可视模式   |
| `<C-v>` | 激活面向列块的可视模式 |
| `gv`    | 重选上次的高亮选区     |

`gv` 命令是个有用的快捷键，它用来重选上一次由可视模式选择的文本范围。不管上个选区是面向字符的、面向行的，还是面向列块的，`gv` 命令都能够正确地工作。不过如果上次的选区被删除了，它也许会工作得不太正常。

| 按键操作            | 用途                                                         |
| ------------------- | ------------------------------------------------------------ |
| `<Esc>` / `<C-[>`   | 回到普通模式                                                 |
| `v` / `V` / `<C-v>` | 切换到普通模式（在对应的面向字符可视模式、面向行的可视模式和面向列块的可视模式中使用时） |
| `v`                 | 切换到面向字符的可视模式                                     |
| `V`                 | 切换到面向行的可视模式                                       |
| `<C-v>`             | 切换到面向列块的可视模式                                     |
| `o`                 | 切换高亮选区的活动端                                         |

## 技巧 22 重复执行面向行的可视命令

## 技巧 23 只要可能，最好用操作符命令，而不是可视命令

可视模式可能比 Vim 的普通模式操作起来更自然一些，但是它有一个缺点：在这个模式下，`.` 命令有时会有一些异常的表现。可以用普通模式下的操作符命令来规避此缺点。

`vit` 高亮选中标签内部的内容，其中 `it` 命令是一种被称为文本对象（text object）的特殊动作命令。

可视模式下的 `U` 命令有一个等效的普通模式命令：`gU{motion}` 

## 技巧 24 用面向列块的可视模式编辑表格数据

使用 `<C-v>` 进入列块可视模式，然后向下移动几行光标，选中一列文本。例如 `<C-v>3j`

## 技巧 25 修改列文本

## 技巧 26 在长短不一的高亮块后添加文本

# 第 5 章 命令行模式

## 技巧 27 认识 Vim 的命令行模式

在按下 `:` 键时，Vim 会切换到命令行模式。这个模式和 shell 下的命令行有些类似，可以输入一条命令，然后按 `<CR>` 执行它。在任意时刻，都可以按 `<Esc>` 键从命令行模式切换回普通模式。

出于历史原因，在命令行模式中执行的命令又被称为 Ex 命令。在按 `/` 调出查找提示符或用 `<C-r>=` 访问表达式寄存器时，命令行模式也会被激活。本节介绍的一些技巧在这些不同的提示符下都适用，不过本节内容主要侧重于Ex 命令。

可以用Ex命令读写文件（`:edit` 和 `:write`）、创建新标签页（`:tabnew`）、分割窗口（`:split`）、操作参数列表（`:prev` / `:next`）及缓冲区列表（`:bprev` / `:bnext`）。事实上，Vim 为几乎所有功能都提供了相应的 Ex命令

| 命令                                            | 用途                                                  |
| ----------------------------------------------- | ----------------------------------------------------- |
| `:[range]delete [x]`                            | 删除指定范围内的行 [到寄存器 x 中]                    |
| `:[range]yank [x]`                              | 复制指定范围的行 [到寄存器 x 中]                      |
| `:[line]put [x]`                                | 在指定行后粘贴寄存器 x 中的内容                       |
| `:[range]copy {address}`                        | 把指定范围内的行拷贝到 {address} 指定的行之下         |
| `:[range]move {address}`                        | 把指定范围内的行移动到 {address} 指定的行之下         |
| `:[range]join`                                  | 连接指定范围内的行                                    |
| `:[range]normal {commands}`                     | 对指定范围内的每一行执行普通模式命令 {commands}       |
| `:[range]substitude/{pattern}/{string}/{flags}` | 对指定范围内出现 {pattern} 的地方替换为 {string}      |
| `:[range]global/{pattern}/[cmd]`                | 对指定范围内匹配 {pattern} 的所有行执行 Ex 命令 {cmd} |

## 技巧 28 在一行或多个连续行上执行命令

`:p` 是 `:print` 命令的简写

`:3p` 此命令会把光标移到第 3 行，然后显示该行的内容。

`:3d` 只需要一条命令就可以跳到第 3 行并删除此行

`:2,5p` 此例会打印第 2 行到第 5 行之间的每一行的内容（含第 2 行及第 5 行）。运行完这条命令后，光标将停留在第 5 行。

符号 `.` 代表当前行的地址

`:.,$p` 用以代表从当前位置到文件末尾间的所有行

符号 `%` 也有特殊含义，它代表当前文件中的所有行

`:%p` 等效于运行 `:1,$p`

`:%s/Practical/Pragmatic/` 将每行内第一个 “Practical” 替换为 “Pragmatic”

`:'<,'>p` 打印高亮选区。符号 `'<` 是代表高亮选区首行的位置标记，`'>` 则代表高亮选区的最后一行，这些位置标记即使在退出可视模式后仍然存在。

`:/<html>/,/<\/html>/p` 模式指定范围

`:/<html>/+1,/<\/html>/-1p` 用偏移对地址进行修正

| 符号 | 地址                          |
| ---- | ----------------------------- |
| `1`  | 文件的第一行                  |
| `$`  | 文件的最后一行                |
| `0`  | 虚拟行，位于文件第一行上方    |
| `.`  | 光标所在行                    |
| `'m` | 包含位置标记 m 的行           |
| `'<` | 高亮选区的起始行              |
| `'>` | 高亮选区的结束行              |
| `%`  | 整个文件（`:1,$` 的简写形式） |

第0行在文件中并不真实存在，但它作为一个地址，在某些特定场景下会很有用处。特别是在把指定范围内的行复制或移动到文件开头时，可以用它做 `:copy {address}` 及 `:move {address}` 命令的最后一个参数。

## 技巧 29 使用 `:t` 和 `:m` 命令复制和移动行